{{- $context := .context -}}
{{- $page := .page -}}
{{- $entry := .entry -}}
{{- $pageLink := .page.RelPermalink -}}

<div class="pt-1 ltr:pr-0 overflow-hidden transition-all ease-in-out duration-200">
  <ul class='relative flex flex-col gap-1 before:absolute before:inset-y-1 before:w-px before:bg-gray-200 before:content-[""] ltr:ml-3 ltr:pl-3 ltr:before:left-0 rtl:mr-3 rtl:pr-3 rtl:before:right-0 dark:before:bg-neutral-800'>
    {{- range $entry }}
      {{- $active := eq $pageLink .link -}}
      {{- $shouldOpen := or (.open) (hasPrefix $pageLink .link) $active | default true }}
      <li class="flex flex-col gap-1 {{ if $shouldOpen }}open{{ end }}">
        {{- template "sidebar-item-link" (dict "context" . "active" $active "title" .title "link" .link) -}}
        {{- if .section -}}
          {{- partial "sidebar/render-tree-branch" (dict "context" $context "entry" .section "page" $page) -}}
        {{- end -}}
      </li>
    {{- end -}}
  </ul>
</div>
