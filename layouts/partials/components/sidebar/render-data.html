{{- $page := .page -}}
{{- $pageLink :=  $page.RelPermalink -}}

{{- range .data -}}
  {{- $active := or (eq $pageLink .link) (eq (strings.TrimSuffix "/" $pageLink) .link) -}}
  {{- $containsPage := hasPrefix $pageLink .link -}}
  {{- $shouldOpen := or (.open) $containsPage $active | default true -}}

  <li class="{{ if $shouldOpen }}open{{ end }}">
    {{- partial "components/sidebar/item-link" (dict "active" $active "title" .title "link" .link "items" .items) -}}
    {{- if .items -}}
      {{- partial "components/sidebar/render-items" (dict "items" .items "link" $pageLink) -}}
    {{- end -}}
  </li>
{{ end }}
